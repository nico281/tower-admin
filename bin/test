#!/usr/bin/env ruby

# Simple test runner that avoids asset compilation issues

puts "ğŸ§ª Tower Admin Test Runner"
puts "========================="

# Set test environment
ENV['RAILS_ENV'] = 'test'

# Create test database if it doesn't exist
puts "\nğŸ“Š Setting up test database..."
system("bin/rails db:test:prepare") || abort("âŒ Failed to prepare test database")

# Run different test suites
test_types = ARGV.empty? ? %w[models controllers system] : ARGV

test_types.each do |test_type|
  case test_type
  when 'models', 'model'
    puts "\nğŸ—ï¸  Running model tests..."
    system("bin/rails test test/models") || abort("âŒ Model tests failed")
    
  when 'controllers', 'controller'
    puts "\nğŸ›ï¸  Running controller tests..."
    system("bin/rails test test/controllers") || abort("âŒ Controller tests failed")
    
  when 'system'
    puts "\nğŸ–¥ï¸  Running system tests..."
    puts "   (This may take a while - browser tests are running...)"
    system("bin/rails test:system") || abort("âŒ System tests failed")
    
  when 'all'
    puts "\nğŸ¯ Running all tests..."
    system("bin/rails test") || abort("âŒ Tests failed")
    
  when 'lint'
    puts "\nğŸ” Running linters..."
    puts "   Running RuboCop..."
    system("bin/rubocop") || abort("âŒ RuboCop failed")
    puts "   Running Brakeman..."
    system("bin/brakeman --quiet") || abort("âŒ Brakeman failed")
    
  else
    puts "âŒ Unknown test type: #{test_type}"
    puts "Available options: models, controllers, system, all, lint"
    exit 1
  end
end

puts "\nâœ… All tests passed! ğŸ‰"